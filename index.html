<script>
// ...deja todo igual arriba...

  function splitFreeRects(freeRects, rect, pw, ph, kerf, cuts, nextOrder){
    // Sacamos el rectángulo usado
    let idx = freeRects.findIndex(r => r.x===rect.x && r.y===rect.y);
    if (idx===-1){ idx = 0; }
    const used = freeRects.splice(idx,1)[0];

    // REGISTRO DE CORTES (líneas de sierra):
    // Corte vertical a la derecha de la pieza (centro del kerf)
    const cutX = used.x + pw + (kerf>0 ? kerf/2 : 0);
    if (cutX <= used.x + used.w && kerf>0){
      cuts.push({
        x1: cutX, y1: used.y,
        x2: cutX, y2: used.y + ph,
        order: nextOrder(), type:'v'
      });
    }
    // Corte horizontal debajo de la pieza (centro del kerf)
    const cutY = used.y + ph + (kerf>0 ? kerf/2 : 0);
    if (cutY <= used.y + used.h && kerf>0){
      cuts.push({
        x1: used.x, y1: cutY,
        x2: used.x + used.w, y2: cutY,
        order: nextOrder(), type:'h'
      });
    }

    // Rectángulos libres resultantes
    const right = {
      x: used.x + pw + kerf,
      y: used.y,
      w: Math.max(0, used.w - pw - kerf),
      h: ph
    };
    const bottom = {
      x: used.x,
      y: used.y + ph + kerf,
      w: used.w,
      h: Math.max(0, used.h - ph - kerf)
    };

    if (right.w>0 && right.h>0) freeRects.push(right);
    if (bottom.w>0 && bottom.h>0) freeRects.push(bottom);
    mergeFreeRects(freeRects);
  }

// ...deja todo igual abajo...
</script>
